trigger: none

pool:
  vmImage: ubuntu-latest

variables:
  terraformVersion: '1.10.5'
  workspaceName: 'dev'

stages:
  - stage: TerraformInitPlan
    jobs:
    - job: TerraformInitPlan
      steps:
        - task: ms-devlabs.custom-terraform-tasks.custom-terraform-installer-task.TerraformInstaller@0
          displayName: Install terraform
          inputs:
            terraformVersion: 1.10.0
        
        - task: AWSShellScript@1
          inputs:
            awsCredentials: 'tod-aws'
            regionName: 'us-east-1'
            scriptType: 'inline'
            inlineScript: |
              pwd
              ls -lrt
              terraform init
              terraform plan --var-file=variables.tfvars
            
  - stage: TerraformInitApply
    jobs:
    - job: TerraformInitApply
      steps:
        - task: ms-devlabs.custom-terraform-tasks.custom-terraform-installer-task.TerraformInstaller@0
          displayName: Install terraform
          inputs:
            terraformVersion: 1.10.0
        
        - task: AWSShellScript@1
          inputs:
            awsCredentials: 'tod-aws'
            regionName: 'us-east-1'
            scriptType: 'inline'
            inlineScript: |
              pwd
              ls -lrt
              terraform init
              terraform apply --var-file=variables.tfvars